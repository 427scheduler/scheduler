{"ast":null,"code":"var _jsxFileName = \"/Users/jenny/Desktop/SOAS/scheduler/src/FlightForm.js\";\nimport React from \"react\";\nimport \"./Form.css\";\nimport firebase from \"./Firebase.js\";\nimport { firebaseCreateDate, firebaseGetAllPilotIDs } from \"./FirebaseHelper.js\";\nimport { RenderSuccessDialog } from \"./Overlay.js\";\n\nDate.prototype.toDateInputValue = function () {\n  var local = new Date(this);\n  local.setMinutes(this.getMinutes() - this.getTimezoneOffset());\n  return local.toJSON().slice(0, 10);\n};\n\nconst fields = [[{\n  name: \"date\",\n  custom: true,\n  size: 'medium'\n}, {\n  name: \"startTime\",\n  displayName: \"est. departure\",\n  size: 'medium'\n}, {\n  name: \"endTime\",\n  displayName: \"est. return\",\n  size: 'medium'\n}, {\n  name: \"flighttime\",\n  custom: true\n}], [{\n  name: \"captain\",\n  select: 'pilots',\n  size: 'medium'\n}, {\n  name: \"fo\",\n  select: 'pilots',\n  displayName: \"first officer\",\n  size: 'medium'\n}, {\n  name: \"fe\",\n  select: 'pilots',\n  displayName: \"flight engineer\",\n  size: 'medium'\n}, {\n  name: \"crew\",\n  select: 'pilots',\n  displayName: \"other crew\",\n  size: 'medium'\n}], [{\n  name: \"ac\",\n  size: 'small',\n  select: 'aclist'\n}, {\n  name: \"backup\",\n  size: 'small',\n  select: 'aclist'\n}, {\n  name: \"mission\",\n  size: 'medium'\n}, {\n  name: \"details\",\n  size: 'medium'\n}, {\n  name: \"config\",\n  size: 'medium',\n  select: 'configlist',\n  default: 'NR'\n}], [{\n  name: \"remarks\",\n  size: 'large'\n}], [{\n  name: \"pri\",\n  displayName: 'sqn pri',\n  size: 'medium'\n}, {\n  name: \"dco\",\n  select: 'dcolist',\n  size: 'medium'\n}]];\nconst dcolist = [\"DCO\", \"DPCO\", \"DNCO\"];\nconst aclist = [\"424\", \"427\", \"455\", \"460\", \"461\", \"462\", \"481\", \"483\", \"484\", \"485\", \"486\", \"487\", \"488\", \"490\", \"498\"];\nconst configlist = [\"S\", \"F\", \"H\", \"B\", \"V\", \"SD\", \"HO\", \"MX\", \"I\", \"BN\", \"C\", \"FF\", \"NR\", \"RP\", \"DC6S\", \"DC6F\", \"DGAU\", \"GC6\", \"DA\", \"INV\"];\n\nfunction RenderButton(props) {\n  return React.createElement(\"div\", {\n    className: \"container-form-btn\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 38\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"wrap-form-btn\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 39\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"form-bgbtn\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 40\n    },\n    __self: this\n  }), React.createElement(\"button\", {\n    className: \"form-btn\",\n    onClick: props.onSubmit,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 41\n    },\n    __self: this\n  }, \"Add Flight\")));\n}\n\nfunction getOptionsList(id, values) {\n  //Creates a datalist object for dropdown options\n  var l = [];\n  values.forEach(v => {\n    l.push(React.createElement(\"option\", {\n      value: v,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 53\n      },\n      __self: this\n    }));\n  });\n  return React.createElement(\"datalist\", {\n    id: id,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55\n    },\n    __self: this\n  }, l);\n}\n\nclass FlightForm extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      date: new Date().toDateInputValue(),\n      startTime: \"\",\n      endTime: \"\",\n      captain: \"\",\n      fo: \"\",\n      fe: \"\",\n      crew: \"\",\n      ac: \"\",\n      backup: \"\",\n      mission: \"\",\n      details: \"\",\n      config: \"\",\n      remarks: \"\",\n      pri: \"\",\n      meal: \"\",\n      dco: \"\",\n      type: \"flight\",\n      pilotsList: []\n    };\n  }\n\n  firebaseSetBool(pilot) {\n    var flightDate = 'flights.' + this.state.date;\n    firebase.firestore().collection(\"pilots\").doc(pilot).update({\n      [flightDate]: true\n    }).then(function () {\n      console.log(\"Boolean successfully set for pilot\");\n    }).catch(function (error) {\n      console.error(\"Error setting flight boolean\", error);\n    });\n  }\n\n  checkError(field) {\n    var ok = true;\n\n    switch (field) {\n      case 'startTime':\n        if (isNaN(this.state.startTime) || !this.props.timeValid(this.state.startTime)) {\n          this.props.flag('startTime', 'Enter between 0000 and 2359');\n          ok = false;\n        }\n\n      case 'endTime':\n        if (isNaN(this.state.endTime) || !this.props.timeValid(this.state.endTime)) {\n          this.props.flag('endTime', 'Enter between 0000 and 2359');\n          ok = false;\n        }\n\n        if (parseInt(this.state.startTime) >= parseInt(this.state.endTime)) {\n          this.props.flag('endTime', 'Return must be after dep.');\n          ok = false;\n        }\n\n      case 'dco':\n        if (!dcolist.includes(this.state.dco.toUpperCase())) {\n          this.props.flag('dco', 'Must be DCO/DNCO/DPCO');\n          ok = false;\n        }\n\n      case 'config':\n        if (!configlist.includes(this.state.config.toUpperCase())) {\n          this.props.flag('config', 'Config not accepted. See dropdown.');\n          ok = false;\n        }\n\n      case 'ac':\n        if (!aclist.includes(this.state.ac.toUpperCase())) {\n          this.props.flag('ac', 'AC not valid');\n          ok = false;\n        }\n\n      case 'backup':\n        if (!aclist.includes(this.state.backup.toUpperCase()) && this.state.backup != '') {\n          this.props.flag('backup', 'Backup not valid');\n          ok = false;\n        }\n\n      case 'pri':\n        if (![\"TASK\", '1', '2', '3', '4', '5', '6'].includes(this.state.pri.toUpperCase())) {\n          this.props.flag('pri', 'Must be task or 1-6');\n          ok = false;\n        }\n\n      default:\n        ok = true;\n        break;\n    }\n\n    return ok;\n  }\n\n  onSubmit() {\n    var ok = true;\n    var remove = document.getElementsByClassName('alert-validate');\n\n    for (let item of remove) {\n      item.classList.remove('alert-validate');\n    }\n\n    var required = ['captain', 'fo', 'ac', 'mission', 'startTime', 'endTime'];\n    required.forEach(field => {\n      if (this.state[field] == \"\") {\n        this.props.flag(field, \"Required\");\n        ok = false;\n      }\n    });\n    var fieldsToCheck = ['startTime', 'endTime', 'dco', 'config', 'ac', 'backup', 'pri'];\n    fieldsToCheck.forEach(field => {\n      ok = ok && this.checkError(field);\n    });\n\n    if (ok) {\n      var newEvent = firebase.firestore().collection(\"events\").doc();\n      newEvent.set(this.state).then(function () {\n        console.log(\"Event successfully added to events!\");\n      }).catch(function (error) {\n        console.error(\"Error adding event: \", error);\n        ok = false;\n      });\n      this.firebaseSetBool(this.state.captain);\n      this.firebaseSetBool(this.state.fo);\n      var updates = {};\n      updates['events.' + this.state.captain] = firebase.firestore.FieldValue.arrayUnion({\n        'type': 'flight',\n        'startTime': this.state.startTime,\n        'endTime': this.state.endTime,\n        'id': newEvent.id\n      });\n      updates['events.' + this.state.fo] = firebase.firestore.FieldValue.arrayUnion({\n        'type': 'flight',\n        'startTime': this.state.startTime,\n        'endTime': this.state.endTime,\n        'id': newEvent.id\n      });\n      var newUpcomingEvents = [firebase.firestore().collection('pilots').doc(this.state.captain).collection('upcoming-events').doc(), firebase.firestore().collection('pilots').doc(this.state.fo).collection('upcoming-events').doc()];\n\n      if (this.state.fe) {\n        updates['events.' + this.state.fe] = firebase.firestore.FieldValue.arrayUnion({\n          'type': 'flight',\n          'startTime': this.state.startTime,\n          'endTime': this.state.endTime,\n          'id': newEvent.id\n        });\n        newUpcomingEvents.push(firebase.firestore().collection('pilots').doc(this.state.fe).collection('upcoming-events').doc());\n        this.firebaseSetBool(this.state.fe);\n      }\n\n      if (this.state.crew) {\n        updates['events.' + this.state.crew] = firebase.firestore.FieldValue.arrayUnion({\n          'type': 'flight',\n          'startTime': this.state.startTime,\n          'endTime': this.state.endTime,\n          'id': newEvent.id\n        });\n        newUpcomingEvents.push(firebase.firestore().collection('pilots').doc(this.state.crew).collection('upcoming-events').doc());\n        this.firebaseSetBool(this.state.crew);\n      }\n\n      let date = this.state.date;\n      firebase.firestore().collection(\"dates\").doc(date).update(updates).then(function () {\n        console.log(\"Event successfully added to dates!\");\n      }).catch(function (error) {\n        firebaseCreateDate(date);\n      });\n      newUpcomingEvents.forEach(x => {\n        x.set({\n          ac: this.state.ac,\n          captain: this.state.captain,\n          flightid: newEvent.id,\n          config: this.state.config,\n          date: this.state.date,\n          fo: this.state.fo,\n          fe: this.state.fe,\n          crew: this.state.crew,\n          details: this.state.details,\n          endTime: this.state.endTime,\n          startTime: this.state.startTime\n        }).then(function () {\n          console.log(\"Event successfully added to pilots!\");\n        }).catch(function (error) {\n          console.error(\"Error writing document: \", error);\n          ok = false;\n        });\n      });\n\n      if (ok) {\n        //window.location.reload();\n        document.getElementsByClassName(\"success-modal\")[0].style.display = \"block\";\n      }\n    }\n  }\n\n  renderField(field) {\n    //TODO: fix datalist to be dynamic\n    const name = field.name;\n    const displayName = field.hasOwnProperty(\"displayName\") ? field.displayName.toUpperCase() : field.name.toUpperCase();\n    const wrapperClassName = field.size + \"-wrapper\";\n    const fieldClassName = \"input\" + (this.state[name] != \"\" ? \" has-val\" : \"\");\n    const datalist = field.hasOwnProperty('select') ? field.select : '';\n    return React.createElement(\"div\", {\n      id: name,\n      className: wrapperClassName + \" validate-input\",\n      onFocus: e => {\n        e.target.parentElement.classList.remove(\"alert-validate\");\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235\n      },\n      __self: this\n    }, getOptionsList('pilots', this.state.pilotsList), getOptionsList('dcolist', dcolist), getOptionsList('aclist', aclist), getOptionsList('configlist', configlist), React.createElement(\"input\", {\n      className: fieldClassName,\n      type: \"text\",\n      name: name,\n      list: datalist,\n      onBlur: e => {\n        this.setState({\n          [name]: e.target.value.trim()\n        });\n        this.checkError(e.target.name);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242\n      },\n      __self: this\n    }), React.createElement(\"span\", {\n      className: \"focus-input\",\n      \"data-placeholder\": displayName,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243\n      },\n      __self: this\n    }));\n  }\n\n  renderCustomField(field) {\n    switch (field.name) {\n      case \"flighttime\":\n        var _ref = [this.state.startTime, this.state.endTime],\n            start = _ref[0],\n            end = _ref[1];\n        var time = \"0 HRS 0 MIN\";\n        var hours = parseInt(end.substring(0, 2)) - parseInt(start.substring(0, 2));\n        var minutes = parseInt(end.substring(2, 4)) - parseInt(start.substring(2, 4));\n\n        if (hours < 0) {\n          hours += 24;\n        }\n\n        if (minutes < 0) {\n          minutes += 60;\n          hours -= 1;\n        }\n\n        if (minutes >= 60) {\n          minutes -= 60;\n          hours += 1;\n        }\n\n        if (hours >= 0 || minutes >= 0) {\n          time = hours + \" HRS \" + minutes + \" MIN\";\n        } else {\n          time = \"0 HRS 0 MIN\";\n        }\n\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 275\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          className: \"input has-val\",\n          type: \"text\",\n          disabled: true,\n          value: time,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 276\n          },\n          __self: this\n        }));\n\n      case \"pri\":\n      /*return (<div className=\"small-wrapper\">\n          <input className='input' required={true} type=\"text\"/> \n          <span className=\"focus-input\" data-placeholder=\"SQN PRI\"></span>\n      </div>);*/\n\n      case \"date\":\n        return React.createElement(\"div\", {\n          className: \"medium-wrapper\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 285\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          className: \"input has-val validate-input\",\n          type: \"date\",\n          name: \"name\",\n          defaultValue: new Date().toDateInputValue(),\n          onBlur: e => {\n            var d = new Date(e.target.value);\n            d.setMinutes(d.getMinutes() + d.getTimezoneOffset());\n            this.setState({\n              date: d.toDateInputValue()\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 286\n          },\n          __self: this\n        }), React.createElement(\"span\", {\n          className: \"focus-input\",\n          \"data-placeholder\": \"DATE\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 289\n          },\n          __self: this\n        }));\n\n      default:\n        const name = field.name;\n        const displayName = field.hasOwnProperty(\"displayName\") ? field.displayName.toUpperCase() : field.name.toUpperCase();\n        const fieldClassName = \"input validate-input\" + (this.state[name] != \"\" ? \" has-val\" : \"\");\n        return React.createElement(\"div\", {\n          id: name,\n          className: field.size + \"-wrapper\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 295\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          className: fieldClassName,\n          autoComplete: \"new-password\",\n          required: field.required,\n          type: \"number\",\n          name: name,\n          onBlur: e => {\n            this.setState({\n              [name]: e.target.value.trim()\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 296\n          },\n          __self: this\n        }), React.createElement(\"span\", {\n          className: \"focus-input\",\n          \"data-placeholder\": displayName,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 297\n          },\n          __self: this\n        }));\n    }\n  }\n\n  renderRow(row) {\n    var fields = [];\n    row.forEach(field => {\n      if (field.hasOwnProperty('custom')) {\n        fields.push(this.renderCustomField(field));\n      } else {\n        fields.push(this.renderField(field));\n      }\n    });\n    return React.createElement(\"div\", {\n      className: \"row-wrapper\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 314\n      },\n      __self: this\n    }, fields);\n  }\n\n  renderForm() {\n    var rows = [];\n    fields.forEach(row => {\n      rows.push(this.renderRow(row));\n    });\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 326\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      className: \"form\",\n      autoComplete: \"off\",\n      onSubmit: e => {\n        e.preventDefault();\n        this.onSubmit();\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 327\n      },\n      __self: this\n    }, rows, React.createElement(RenderSuccessDialog, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 329\n      },\n      __self: this\n    }), React.createElement(RenderButton, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 330\n      },\n      __self: this\n    })));\n  }\n\n  firebaseGetAllPilotIDs() {\n    firebase.firestore().collection(\"pilots\").get().then(querySnapshot => {\n      var pilots = [];\n      querySnapshot.forEach(pilot => {\n        if (pilot.data().displayName != null) {\n          pilots.push(pilot.id);\n        }\n      });\n      this.setState({\n        pilotsList: pilots\n      });\n    }).catch(function (error) {\n      console.log(\"Error getting all pilots: \", error);\n    });\n  }\n\n  componentDidMount() {\n    this.firebaseGetAllPilotIDs();\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 361\n      },\n      __self: this\n    }, this.renderForm());\n  }\n\n}\n\nexport default FlightForm;","map":{"version":3,"sources":["/Users/jenny/Desktop/SOAS/scheduler/src/FlightForm.js"],"names":["React","firebase","firebaseCreateDate","firebaseGetAllPilotIDs","RenderSuccessDialog","Date","prototype","toDateInputValue","local","setMinutes","getMinutes","getTimezoneOffset","toJSON","slice","fields","name","custom","size","displayName","select","default","dcolist","aclist","configlist","RenderButton","props","onSubmit","getOptionsList","id","values","l","forEach","v","push","FlightForm","Component","constructor","state","date","startTime","endTime","captain","fo","fe","crew","ac","backup","mission","details","config","remarks","pri","meal","dco","type","pilotsList","firebaseSetBool","pilot","flightDate","firestore","collection","doc","update","then","console","log","catch","error","checkError","field","ok","isNaN","timeValid","flag","parseInt","includes","toUpperCase","remove","document","getElementsByClassName","item","classList","required","fieldsToCheck","newEvent","set","updates","FieldValue","arrayUnion","newUpcomingEvents","x","flightid","style","display","renderField","hasOwnProperty","wrapperClassName","fieldClassName","datalist","e","target","parentElement","setState","value","trim","renderCustomField","start","end","time","hours","substring","minutes","d","renderRow","row","renderForm","rows","preventDefault","get","querySnapshot","pilots","data","componentDidMount","render"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport \"./Form.css\";\nimport firebase from \"./Firebase.js\";\nimport {firebaseCreateDate, firebaseGetAllPilotIDs} from \"./FirebaseHelper.js\";\nimport {RenderSuccessDialog} from \"./Overlay.js\";\n\nDate.prototype.toDateInputValue = (function() {\n    var local = new Date(this);\n    local.setMinutes(this.getMinutes() - this.getTimezoneOffset());\n    return local.toJSON().slice(0,10);\n});\n\nconst fields = [[{name: \"date\", custom: true, size: 'medium'}, \n{name: \"startTime\", displayName: \"est. departure\", size: 'medium'}, \n{name: \"endTime\", displayName: \"est. return\", size: 'medium'}, \n{name: \"flighttime\", custom: true}],\n\n[{name: \"captain\", select: 'pilots', size: 'medium'}, \n{name: \"fo\", select: 'pilots', displayName: \"first officer\", size: 'medium'}, \n{name: \"fe\", select: 'pilots', displayName: \"flight engineer\", size: 'medium'}, \n{name: \"crew\", select: 'pilots', displayName: \"other crew\", size: 'medium'}], \n\n[{name: \"ac\", size: 'small', select: 'aclist'}, \n{name: \"backup\", size: 'small', select: 'aclist'}, \n{name: \"mission\", size: 'medium'}, \n{name: \"details\", size: 'medium'}, \n{name: \"config\", size: 'medium', select: 'configlist', default: 'NR'}], \n[{name: \"remarks\", size: 'large'}], \n[{name: \"pri\", displayName: 'sqn pri', size: 'medium'}, \n{name: \"dco\", select: 'dcolist', size: 'medium'}] ];\n\nconst dcolist = [\"DCO\", \"DPCO\", \"DNCO\"];\nconst aclist =[\"424\",\"427\",\"455\",\"460\",\"461\",\"462\",\"481\",\"483\",\"484\",\"485\",\"486\",\"487\",\"488\",\"490\",\"498\"];\nconst configlist = [\"S\",\"F\",\"H\",\"B\",\"V\",\"SD\",\"HO\",\"MX\",\"I\",\"BN\",\"C\",\"FF\",\"NR\",\"RP\",\"DC6S\",\"DC6F\",\"DGAU\",\"GC6\",\"DA\",\"INV\",];\n\nfunction RenderButton(props) {\n    return (\n        <div className=\"container-form-btn\">\n            <div className=\"wrap-form-btn\">\n                <div className=\"form-bgbtn\"></div>\n                <button className=\"form-btn\" onClick={props.onSubmit}>\n                    Add Flight\n                </button>\n            </div>\n        </div>\n    );\n}\n\nfunction getOptionsList(id, values) {\n    //Creates a datalist object for dropdown options\n    var l = [];\n    values.forEach((v) => {\n        l.push(<option value={v}/>);\n    });\n    return (<datalist id={id}>{l}</datalist>);\n}\n\n\n\nclass FlightForm extends React.Component {\n    constructor(props) { \n        super(props);\n        this.state = {\n            date: new Date().toDateInputValue(),\n            startTime: \"\",\n            endTime: \"\",\n            captain: \"\",\n            fo: \"\",\n            fe: \"\",\n            crew: \"\",\n            ac: \"\",\n            backup: \"\",\n            mission: \"\",\n            details: \"\",\n            config: \"\",\n            remarks: \"\",\n            pri: \"\",\n            meal: \"\",\n            dco: \"\",\n            type: \"flight\",\n            pilotsList: [],\n        }\n    }\n\n    firebaseSetBool(pilot) {\n        var flightDate = 'flights.' + this.state.date;\n        firebase.firestore().collection(\"pilots\").doc(pilot).update({[flightDate]: true})\n        .then(function() {\n            console.log(\"Boolean successfully set for pilot\");})\n        .catch(function(error) {\n            console.error(\"Error setting flight boolean\", error);\n        })\n    }\n\n    checkError(field) {\n        var ok = true;\n        switch (field){\n        case 'startTime':\n            if (isNaN(this.state.startTime) || !this.props.timeValid(this.state.startTime)) {\n                this.props.flag('startTime', 'Enter between 0000 and 2359');\n                ok = false;\n            }\n        case 'endTime':\n            if (isNaN(this.state.endTime) || !this.props.timeValid(this.state.endTime)) {\n                this.props.flag('endTime', 'Enter between 0000 and 2359');\n                ok = false;\n            }\n            if (parseInt(this.state.startTime) >= parseInt(this.state.endTime)) {\n                this.props.flag('endTime', 'Return must be after dep.');\n                ok = false;\n            }\n        case 'dco':\n            if (!(dcolist.includes(this.state.dco.toUpperCase()))) {\n                this.props.flag('dco', 'Must be DCO/DNCO/DPCO');\n                ok = false;\n            }\n        case 'config':\n            if (!(configlist.includes(this.state.config.toUpperCase()))) {\n                this.props.flag('config', 'Config not accepted. See dropdown.');\n                ok = false;\n            }\n        case 'ac':\n            if (!(aclist.includes(this.state.ac.toUpperCase()))) {\n                this.props.flag('ac', 'AC not valid');\n                ok = false;\n            }\n        case 'backup':\n            if (!(aclist.includes(this.state.backup.toUpperCase())) && this.state.backup != '') {\n                this.props.flag('backup', 'Backup not valid');\n                ok = false;\n            }\n        case 'pri':\n            if (![\"TASK\", '1', '2', '3', '4', '5', '6'].includes(this.state.pri.toUpperCase())) {\n                this.props.flag('pri', 'Must be task or 1-6');\n                ok = false;\n            }\n        default: \n            ok = true;\n            break;\n        }\n        return ok\n    }\n\n\n\n\n    onSubmit() { \n        var ok = true;\n        var remove = document.getElementsByClassName('alert-validate');\n        for (let item of remove) {\n            item.classList.remove('alert-validate');\n        }\n        var required = ['captain', 'fo', 'ac', 'mission', 'startTime', 'endTime'];\n        required.forEach(field => {\n            if (this.state[field] == \"\") {\n                this.props.flag(field, \"Required\");\n                ok = false;\n            }\n        })\n        var fieldsToCheck =['startTime', 'endTime', 'dco', 'config', 'ac', 'backup', 'pri'];\n        fieldsToCheck.forEach((field) => {ok = ok && this.checkError(field)});\n        \n        \n        if (ok) {\n            var newEvent = firebase.firestore().collection(\"events\").doc();\n            newEvent.set(this.state)\n            .then(function() {\n                console.log(\"Event successfully added to events!\");})\n            .catch(function(error) {\n                console.error(\"Error adding event: \", error);\n                ok = false;\n            });\n\n            this.firebaseSetBool(this.state.captain);\n            this.firebaseSetBool(this.state.fo);\n            var updates = {};\n            updates['events.'+this.state.captain] = firebase.firestore.FieldValue.arrayUnion({'type':'flight', 'startTime': this.state.startTime, 'endTime': this.state.endTime, 'id':newEvent.id});\n            updates['events.'+this.state.fo] = firebase.firestore.FieldValue.arrayUnion({'type':'flight', 'startTime': this.state.startTime, 'endTime': this.state.endTime, 'id':newEvent.id});\n            var newUpcomingEvents = [   firebase.firestore().collection('pilots').doc(this.state.captain).collection('upcoming-events').doc(),\n                                        firebase.firestore().collection('pilots').doc(this.state.fo).collection('upcoming-events').doc()];\n\n            if (this.state.fe) {\n                updates['events.'+this.state.fe] = firebase.firestore.FieldValue.arrayUnion({'type':'flight', 'startTime': this.state.startTime, 'endTime': this.state.endTime, 'id':newEvent.id});\n                newUpcomingEvents.push(firebase.firestore().collection('pilots').doc(this.state.fe).collection('upcoming-events').doc());\n                this.firebaseSetBool(this.state.fe);\n            }\n            if (this.state.crew) {\n                updates['events.'+this.state.crew] = firebase.firestore.FieldValue.arrayUnion({'type':'flight', 'startTime': this.state.startTime, 'endTime': this.state.endTime, 'id':newEvent.id});\n                newUpcomingEvents.push(firebase.firestore().collection('pilots').doc(this.state.crew).collection('upcoming-events').doc());\n                this.firebaseSetBool(this.state.crew);\n            }\n            let date = this.state.date;\n            firebase.firestore().collection(\"dates\").doc(date).update(updates)\n            .then(function() {\n                console.log(\"Event successfully added to dates!\");})\n            .catch(function(error) {\n                firebaseCreateDate(date);\n            })\n\n\n            newUpcomingEvents.forEach((x)=>{x.set({\n                ac: this.state.ac,\n                captain: this.state.captain,\n                flightid: newEvent.id,\n                config: this.state.config,\n                date: this.state.date,\n                fo: this.state.fo,\n                fe: this.state.fe,\n                crew: this.state.crew,\n                details: this.state.details,\n                endTime: this.state.endTime,\n                startTime: this.state.startTime,})\n            .then(function() {\n                console.log(\"Event successfully added to pilots!\");})\n            .catch(function(error) {\n                console.error(\"Error writing document: \", error);\n                ok = false;\n            })})\n\n            if (ok) {\n                //window.location.reload();\n                document.getElementsByClassName(\"success-modal\")[0].style.display = \"block\";\n            }\n        }\n    }\n\n    renderField(field) {\n        //TODO: fix datalist to be dynamic\n        const name = field.name;\n        const displayName = field.hasOwnProperty(\"displayName\") ? field.displayName.toUpperCase() : field.name.toUpperCase();\n        const wrapperClassName = field.size + \"-wrapper\";\n        const fieldClassName = \"input\"+ (this.state[name] != \"\" ? \" has-val\": \"\");\n        const datalist = field.hasOwnProperty('select') ? field.select : '';\n        return (\n            <div id={name} className={wrapperClassName + \" validate-input\"} onFocus={(e)=>{e.target.parentElement.classList.remove(\"alert-validate\")}}>\n\n            {getOptionsList('pilots', this.state.pilotsList)}\n            {getOptionsList('dcolist', dcolist)}\n            {getOptionsList('aclist', aclist)}\n            {getOptionsList('configlist', configlist)}\n\n            <input className={fieldClassName} type=\"text\" name={name} list={datalist} onBlur={(e)=>{this.setState({[name]: e.target.value.trim()}); this.checkError(e.target.name);}}/>\n            <span className=\"focus-input\" data-placeholder={displayName}></span>\n            </div>\n            \n        )\n    }\n\n    renderCustomField(field) {\n        switch(field.name) {\n            case \"flighttime\": \n                \n                var [start, end] = [this.state.startTime, this.state.endTime];\n                var time = \"0 HRS 0 MIN\";\n                var hours = parseInt(end.substring(0, 2))- parseInt(start.substring(0, 2));\n                var minutes = parseInt(end.substring(2, 4))- parseInt(start.substring(2, 4));\n                \n                if (hours < 0) {\n                    hours += 24\n                }\n                if (minutes < 0) {\n                    minutes += 60;\n                    hours -= 1;\n                }\n                if (minutes >= 60) {\n                    minutes -= 60;\n                    hours += 1;\n                }\n                if (hours >= 0 || minutes >= 0){ \n                    time = hours + \" HRS \" + minutes + \" MIN\";\n                }\n                else {\n                    time = \"0 HRS 0 MIN\";\n                }\n                return (<div>\n                    <input className='input has-val' type=\"text\" disabled={true} value={time}/>\n                </div>);\n            case \"pri\": \n                /*return (<div className=\"small-wrapper\">\n                    <input className='input' required={true} type=\"text\"/> \n                    <span className=\"focus-input\" data-placeholder=\"SQN PRI\"></span>\n                </div>);*/\n            \n            case \"date\": \n                return (<div className=\"medium-wrapper\">\n                <input className=\"input has-val validate-input\" type=\"date\" name=\"name\" defaultValue={new Date().toDateInputValue()} onBlur={(e)=>{var d = new Date(e.target.value);\n                    d.setMinutes( d.getMinutes() + d.getTimezoneOffset() );\n                    this.setState({date: d.toDateInputValue()});}}/>\n                <span className=\"focus-input\" data-placeholder=\"DATE\"></span>\n            </div>)\n            default: \n                const name = field.name;\n                const displayName = field.hasOwnProperty(\"displayName\") ? field.displayName.toUpperCase() : field.name.toUpperCase();\n                const fieldClassName = \"input validate-input\"+ (this.state[name] != \"\"? \" has-val\": \"\")\n                return (<div id={name} className={field.size + \"-wrapper\"}>\n                    <input className={fieldClassName} autoComplete=\"new-password\" required={field.required} type=\"number\" name={name} onBlur={(e)=>{this.setState({[name]: e.target.value.trim()});}}/>\n                    <span className=\"focus-input\" data-placeholder={displayName}></span>\n                </div>);\n        }\n    }\n\n    renderRow(row) {\n        var fields = [];\n        row.forEach(field => {\n            if (field.hasOwnProperty('custom')) {\n                fields.push(this.renderCustomField(field));\n            }\n            else {\n                fields.push(this.renderField(field));\n            }\n            \n        });\n        return (\n            <div className=\"row-wrapper\"> \n                {fields}\n            </div>\n        )\n    }\n\n    renderForm() {\n        var rows = []\n        fields.forEach(row => {\n            rows.push(this.renderRow(row));\n        });\n        return (\n            <div>\n                <form className=\"form\" autoComplete=\"off\"  onSubmit={(e)=>{e.preventDefault(); this.onSubmit()}}>\n                    {rows}\n                    <RenderSuccessDialog/>\n                    <RenderButton/>\n                </form>\n            </div>\n        );\n    }\n\n    firebaseGetAllPilotIDs() {\n        firebase.firestore().collection(\"pilots\")\n            .get()\n            .then((querySnapshot) => {\n                var pilots = [];\n                querySnapshot.forEach((pilot)=> {\n                    if (pilot.data().displayName != null) {\n                        pilots.push(pilot.id)\n                    }\n                })\n                this.setState({pilotsList: pilots});\n            })\n            .catch(function(error) {\n                console.log(\"Error getting all pilots: \", error);\n            });\n    \n    }\n\n    componentDidMount() {\n        this.firebaseGetAllPilotIDs();\n    }\n    \n\n    render() {\n        return (\n            <div>\n                {this.renderForm()}\n            </div>\n        );\n    }\n}\n\nexport default FlightForm;"]},"metadata":{},"sourceType":"module"}